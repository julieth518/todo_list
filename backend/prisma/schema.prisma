generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// ========================
// üìå MODELOS PRINCIPALES
// ========================

model User {
  id        Int       @id @default(autoincrement())
  name      String
  email     String    @unique
  password  String
  avatarUrl String?   // Foto opcional

  teams     TeamMember[]
  tasks     Task[]         @relation("UserTasks")        // Creador
  assigned  TaskAssignment[] // Tareas asignadas
  comments  Comment[]
  
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model Team {
  id        Int          @id @default(autoincrement())
  name      String
  description String?

  members   TeamMember[]
  tasks     Task[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Relaci√≥n Usuario <-> Equipo con Rol
model TeamMember {
  id        Int       @id @default(autoincrement())
  role      TeamRole  @default(MEMBER)

  user      User      @relation(fields: [userId], references: [id])
  userId    Int

  team      Team      @relation(fields: [teamId], references: [id])
  teamId    Int
}

// ========================
// üìù MODELO DE TAREAS
// ========================

model Task {
  id          Int            @id @default(autoincrement())
  title       String
  description String?
  status      TaskStatus      @default(PENDING)
  priority    TaskPriority    @default(MEDIUM)
  dueDate     DateTime?

  // üîó Relaci√≥n al equipo y al creador
  team        Team            @relation(fields: [teamId], references: [id])
  teamId      Int

  creator     User            @relation("UserTasks", fields: [creatorId], references: [id])
  creatorId   Int

  // üßë‚Äçü§ù‚Äçüßë Asignaciones m√∫ltiples
  assigned    TaskAssignment[]
  comments    Comment[]
  tags        TaskTag[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// üè∑ Etiquetas para clasificar tareas
model Tag {
  id       Int      @id @default(autoincrement())
  name     String   @unique
  color    String?

  tasks    TaskTag[]
}

model TaskTag {
  id       Int     @id @default(autoincrement())
  task     Task    @relation(fields: [taskId], references: [id])
  taskId   Int

  tag      Tag     @relation(fields: [tagId], references: [id])
  tagId    Int
}

// Modelo simple para la UI actual (frontend espera campos: id, author, text, completed, editor)
model SimpleTask {
  id        Int      @id @default(autoincrement())
  author    String
  text      String
  completed Boolean  @default(false)
  editor    String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
// üë• Asignaci√≥n de usuarios a tareas
model TaskAssignment {
  id       Int   @id @default(autoincrement())
  task     Task  @relation(fields: [taskId], references: [id])
  taskId   Int

  user     User  @relation(fields: [userId], references: [id])
  userId   Int

  assignedAt DateTime @default(now())
}

// üí¨ Comentarios en tareas
model Comment {
  id       Int      @id @default(autoincrement())
  body     String

  task     Task     @relation(fields: [taskId], references: [id])
  taskId   Int

  user     User     @relation(fields: [userId], references: [id])
  userId   Int

  createdAt DateTime @default(now())
}

// ========================
// üéõ ENUMS
// ========================

enum TeamRole {
  ADMIN
  MEMBER
}

enum TaskStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELED
}

enum TaskPriority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}
